<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SLASHUP | Competitive PvP</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    
    <style>
        :root {
            --bg: #0b0b10;
            --panel: rgba(20, 20, 25, 0.95);
            --panel-border: 1px solid rgba(255, 255, 255, 0.08);
            --accent: #ff3e3e; 
            --accent-glow: rgba(255, 62, 62, 0.5);
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
            --win: #44ff44;
            --loss: #ff4444;
            --text-main: #ffffff;
            --text-dim: #8888aa;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg);
            background-image: linear-gradient(to bottom, transparent, var(--bg)), url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
            color: var(--text-main);
            font-family: 'Rajdhani', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; width: 100%; }
        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }

        /* --- UI COMPONENTS --- */
        .recent-tag {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 5px 12px; font-size: 0.8rem; color: #888; cursor: pointer; transition: 0.2s;
            font-family: 'Share Tech Mono'; display: inline-flex; align-items: center; gap: 8px;
        }
        .recent-tag:hover { border-color: var(--accent); color: white; background: rgba(255, 62, 62, 0.1); }
        .recent-head { width: 16px; height: 16px; border-radius: 2px; }

        .search-container { position: relative; width: 100%; max-width: 600px; }
        .search-input { 
            width: 100%; padding:1rem; background:rgba(0,0,0,0.5); border:1px solid #333; 
            color:white; outline:none; font-family: 'Share Tech Mono'; font-size: 1.2rem; transition: 0.3s;
        }
        .search-input:focus { border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow); }

        #suggestions-box {
            position: absolute; top: 100%; left: 0; width: 100%;
            background: #15151a; border: 1px solid #333; border-top: none;
            z-index: 1000; display: none; 
        }
        .suggestion-item {
            padding: 1rem; cursor: pointer; border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex; align-items: center; gap: 10px; transition: 0.2s;
        }
        .suggestion-item:hover { background: rgba(255, 62, 62, 0.1); color: var(--accent); padding-left: 1.5rem; }
        .sug-head { width: 24px; height: 24px; border-radius: 3px; }

        /* --- NAV --- */
        nav { background: rgba(11, 11, 16, 0.9); backdrop-filter: blur(10px); border-bottom: var(--panel-border); position: sticky; top: 0; z-index: 100; padding: 1.5rem 0; }
        .nav-inner { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 2rem; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; cursor:pointer; }
        .logo span { color: var(--accent); }
        .nav-links { display: flex; gap: 2rem; }
        .nav-btn { background: none; border: none; color: var(--text-dim); font-family: 'Share Tech Mono'; font-size: 1rem; cursor: pointer; transition: 0.3s; text-transform: uppercase; }
        .nav-btn:hover, .nav-btn.active { color: var(--accent); text-shadow: 0 0 10px var(--accent-glow); }

        /* --- PROFILE LAYOUT (THE FIX) --- */
        .profile-container { 
            display: grid; 
            grid-template-columns: 320px 1fr; /* Left col fixed, Right col flexible */
            gap: 2rem; 
            display: none; 
            width: 100%; 
            transition: opacity 0.3s; 
        }
        .profile-container.visible { display: grid; }
        
        .profile-left { display: flex; flex-direction: column; gap: 1.5rem; }
        .player-data { display: flex; flex-direction: column; gap: 1.5rem; }

        @media (max-width: 900px) {
            .profile-container { grid-template-columns: 1fr; } 
        }

        /* --- SKIN VIEWER --- */
        .skin-viewer { 
            height: 450px; background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 70%); 
            display: flex; justify-content: center; align-items: center; border: var(--panel-border); position: relative;
            box-shadow: 0 0 50px rgba(255, 62, 62, 0.1); border: 1px solid rgba(255, 62, 62, 0.2);
        }
        .skin-img { height: 90%; filter: drop-shadow(0 15px 30px rgba(0,0,0,0.6)); transition: opacity 0.3s; opacity: 0; }
        .skin-img.loaded { opacity: 1; animation: float 4s ease-in-out infinite; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-15px); } 100% { transform: translateY(0px); } }

        /* --- STATS & CHARTS --- */
        .panel-box { background: var(--panel); border: var(--panel-border); padding: 1.5rem; }
        .section-title { font-size: 1.2rem; color: var(--accent); margin-bottom: 1rem; font-family: 'Share Tech Mono'; text-transform: uppercase; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 0.5rem; }
        
        .stats-big-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
        .big-stat { background: rgba(255,255,255,0.03); padding: 1rem; border-left: 3px solid var(--text-dim); }
        .big-stat.accent { border-color: var(--accent); }
        .big-stat-val { font-size: 2rem; font-family: 'Share Tech Mono'; }

        .chart-container { background: rgba(255,255,255,0.03); border: var(--panel-border); padding: 1.5rem; height: 300px; width: 100%; }

        /* --- SKELETON --- */
        .skeleton {
            background-color: #1a1a20;
            background-image: linear-gradient(90deg, rgba(255, 255, 255, 0) 0, rgba(255, 255, 255, 0.05) 20%, rgba(255, 255, 255, 0.1) 60%, rgba(255, 255, 255, 0));
            background-size: 200% 100%; animation: shine 1.5s infinite linear;
            color: transparent !important; border-color: transparent !important; pointer-events: none; border-radius: 4px;
        }
        .skeleton img, .skeleton i, .skeleton canvas { opacity: 0; }
        @keyframes shine { to { background-position: -200% 0; } }

        /* --- MISC --- */
        .page-section { display: none; padding-bottom: 5rem; animation: fadeIn 0.5s; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .cta-btn { background: var(--accent); color: white; padding: 1rem 3rem; font-family: 'Share Tech Mono'; font-size: 1.2rem; border: none; cursor: pointer; clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px); }
        .hero { height: 70vh; display: flex; align-items: center; justify-content: center; text-align: center; }
        .hero h1 { font-size: 5rem; line-height: 0.9; text-transform: uppercase; margin-bottom: 1.5rem; }

        /* --- MATCH HISTORY --- */
        .match-card { display: flex; align-items: center; justify-content: space-between; background: rgba(255, 255, 255, 0.02); padding: 1rem 1.5rem; border-left: 4px solid #555; margin-bottom: 10px; }
        .match-card.win { border-left-color: var(--win); background: linear-gradient(90deg, rgba(68, 255, 68, 0.05) 0%, transparent 100%); }
        .match-card.loss { border-left-color: var(--loss); background: linear-gradient(90deg, rgba(255, 68, 68, 0.05) 0%, transparent 100%); }

        /* --- TAGS & BADGES --- */
        .player-tag { font-family: 'Share Tech Mono'; font-size: 0.6rem; padding: 2px 6px; border-radius: 4px; margin-left: 10px; font-weight: bold; }
        .tag-owner { background: #ff3e3e; color: white; }
        .rank-badge { background: var(--panel); color: #888; border: 1px solid #444; padding: 2px 8px; font-weight: bold; }

        /* --- TOAST --- */
        #toast-box { position: fixed; bottom: 30px; right: -300px; background: var(--panel); border-left: 4px solid var(--accent); padding: 1rem 2rem; z-index: 1000; transition: right 0.5s; display: flex; align-items: center; gap: 15px; }
        #toast-box.show { right: 30px; }
    </style>
</head>
<body>
    <canvas id="bg-canvas"></canvas>

    <div id="toast-box">
        <i class="fas fa-check-circle toast-icon" style="color:var(--accent); font-size:1.5rem;"></i>
        <div>
            <div style="font-weight: bold; color: white;">IP Copied!</div>
            <div style="font-size: 0.8rem; color: #aaa;">See you on the battlefield.</div>
        </div>
    </div>

    <nav>
        <div class="container nav-inner">
            <div class="logo" onclick="switchTab('home')">SLASH<span>UP</span></div>
            <div class="nav-links">
                <button class="nav-btn active" onclick="switchTab('home')" id="btn-home">HOME</button>
                <button class="nav-btn" onclick="switchTab('stats')" id="btn-stats">STATS</button>
                <button class="nav-btn" onclick="copyIP()" style="color: #44ff44;">COPY IP</button>
            </div>
        </div>
    </nav>

    <!-- === HOME === -->
    <div id="home-page" class="page-section active">
        <div class="container">
            <section class="hero">
                <div>
                    <h1>High Fidelity<br>Combat</h1>
                    <p>Experience the next generation of Minecraft PvP.</p>
                    <button class="cta-btn" onclick="copyIP()">PLAY.SLASHUP.NET</button>
                </div>
            </section>
        </div>
    </div>

    <!-- === STATS === -->
    <div id="stats-page" class="page-section">
        <div class="container stats-hero">
            <h1 style="margin: 3rem 0;">PLAYER DATABASE</h1>
            
            <div class="search-wrapper" style="display:flex; gap:10px; margin-bottom:3rem; width: 100%; max-width: 600px;">
                <div class="search-container">
                    <input type="text" id="playerInput" class="search-input" placeholder="Search Username..." autocomplete="off">
                    <div id="suggestions-box"></div>
                </div>
                <button class="cta-btn" onclick="fetchStats()" style="padding:0 2rem; margin:0;"><i class="fas fa-search"></i></button>
            </div>
            
            <!-- RECENT SEARCHES -->
            <div id="recent-container" style="display:none; margin-bottom: 2rem; width:100%; max-width:600px;">
                <div style="font-size: 0.7rem; color: #666; margin-bottom: 8px; font-family: 'Share Tech Mono';">RECENT SEARCHES</div>
                <div id="recent-list" style="display:flex; gap:10px; flex-wrap:wrap;"></div>
            </div>

            <div class="profile-container" id="profileDisplay">
                
                <!-- LEFT COLUMN: SKIN + BIOMETRICS + NEMESIS -->
                <div class="profile-left">
                    <!-- Skin -->
                    <div class="skin-viewer skeleton" id="skinContainer">
                        <img src="" id="skinImg" class="skin-img" alt="Player Skin">
                    </div>

                    <!-- Biometrics (Radar) -->
                    <div class="panel-box skeleton" id="bioBox" style="display:flex; flex-direction:column; align-items:center; position:relative; min-height: 350px;">
                        <div class="section-title" style="width:100%; border:none; margin-bottom:0;">COMBAT BIOMETRICS</div>
                        <div style="width: 100%; height: 280px; position: relative;">
                            <canvas id="radarChart"></canvas>
                        </div>
                        <div id="playerClass" style="position:absolute; bottom:10px; right:10px; font-family:'Share Tech Mono'; color:var(--accent); font-size:1.5rem; opacity:0.8;">
                            CLASS: <span style="color:white;">UNKNOWN</span>
                        </div>
                    </div>

                    <!-- Nemesis -->
                    <div class="panel-box skeleton" id="nemesisBox" style="background: linear-gradient(135deg, rgba(20,20,25,0.9), rgba(255,0,0,0.05)); border: 1px solid rgba(255, 62, 62, 0.2); text-align:center;">
                        <div class="section-title" style="color:var(--loss); border-color:rgba(255, 62, 62, 0.3);">
                            <i class="fas fa-skull-crossbones"></i> ARCH NEMESIS
                        </div>
                        <div style="padding-top:1rem;">
                            <img src="" id="nemesisHead" style="width:64px; height:64px; border-radius:8px; border:2px solid var(--loss); box-shadow: 0 0 15px rgba(255, 62, 62, 0.3);">
                            <h2 id="nemesisName" style="margin-top:10px; font-size:1.5rem;">-</h2>
                            <p style="color:#888; font-family:'Share Tech Mono'; font-size:0.9rem;">Killed you <span id="nemesisKills" style="color:white; font-weight:bold;">0</span> times</p>
                        </div>
                    </div>
                </div>
        
                <!-- RIGHT COLUMN: STATS -->
                <div class="player-data">
                    <div style="margin-bottom:1rem; display:flex; justify-content:space-between; align-items:flex-end;">
                        <div>
                            <div style="display:flex; align-items:center; gap: 10px;">
                                <h2 class="skeleton" style="display:inline-block; margin:0; min-width: 150px;" id="nameDisplay">Player</h2>
                                <span id="tagDisplay"></span> 
                                <button class="share-btn" onclick="shareProfile()"><i class="fas fa-share-alt"></i></button>
                            </div>
                            <div style="margin-top: 10px; display: flex; align-items: center; gap: 15px;">
                                <span class="rank-badge skeleton" id="rankDisplay" style="min-width: 50px;"># -</span>
                                <!-- Corrected View ID -->
                                <div id="viewContainer" class="skeleton" style="color: var(--text-dim); min-width: 60px;">
                                    <i class="far fa-eye" style="margin-right: 5px;"></i>
                                    <span id="viewCount">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
            
                    <div class="stats-big-grid">
                        <div class="big-stat accent">
                            <div style="font-size:0.8rem; color:#888;">K/D RATIO</div>
                            <div class="big-stat-val skeleton" id="kdrVal">-</div>
                        </div>
                        <div class="big-stat">
                            <div style="font-size:0.8rem; color:#888;">TOTAL WINS</div>
                            <div class="big-stat-val skeleton" id="winsVal">-</div>
                        </div>
                        <div class="big-stat">
                            <div style="font-size:0.8rem; color:#888;">BEST STREAK</div>
                            <div class="big-stat-val skeleton" id="streakVal">-</div>
                        </div>
                    </div>

                    <!-- Performance Chart -->
                    <div class="chart-container skeleton" id="chartBox">
                        <div class="section-title" style="font-size:1rem; border:none; margin-bottom:10px;">Performance History</div>
                        <canvas id="performanceChart"></canvas>
                    </div>
            
                    <!-- Win Rate -->
                    <div style="background: rgba(255,255,255,0.03); padding: 1rem; border: var(--panel-border);" class="skeleton" id="wrBox">
                        <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:0.8rem; color:#888; font-family:'Share Tech Mono';">
                            <span>WIN RATE</span><span id="wr-percent">50%</span>
                        </div>
                        <div style="height:8px; background:#333; display:flex; width:100%;">
                            <div id="bar-win" style="background:var(--win); width:50%;"></div>
                            <div id="bar-loss" style="background:var(--loss); width:50%;"></div>
                        </div>
                    </div>
            
                    <div class="panel-box">
                        <div class="section-title" style="font-size:1rem;">Recent Matches</div>
                        <div id="matchHistoryList">
                            <div class="match-card skeleton" style="height: 60px;"></div>
                            <div class="match-card skeleton" style="height: 60px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let myChart = null;
        let myRadar = null;
        const SPECIAL_TAGS = { "hugeadventure": { text: "OWNER", class: "tag-owner" } };

        // --- TABS ---
        function switchTab(tab) {
            document.querySelectorAll('.page-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tab + '-page').classList.add('active');
            document.getElementById('btn-' + tab).classList.add('active');
        }

        // --- INITIALIZATION ---
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const playerParam = urlParams.get('player');
            if(playerParam) {
                document.getElementById('playerInput').value = playerParam;
                switchTab('stats');
                fetchStats();
            }
            updateRecent();
            initParticles();
            animateParticles();
            setupAutocomplete(); // Fix for Autocomplete
        }

        // --- FETCH STATS ---
        async function fetchStats() {
            const username = document.getElementById('playerInput').value;
            if(!username) return;
        
            // 1. SETUP SKELETONS
            document.getElementById('profileDisplay').classList.add('visible'); 
            
            const idsToLoad = ['nameDisplay', 'rankDisplay', 'viewContainer', 'kdrVal', 
                   'winsVal', 'streakVal', 'skinContainer', 'chartBox', 'wrBox', 
                   'bioBox', 'nemesisBox'];
                               
            idsToLoad.forEach(id => {
                const el = document.getElementById(id);
                if(el) el.classList.add('skeleton');
            });
            
            // Clear Images
            const skinImg = document.getElementById('skinImg');
            skinImg.classList.remove('loaded');
            skinImg.src = ''; 
            document.getElementById('nemesisHead').src = '';
            
            // Reset History
            const historyContainer = document.getElementById('matchHistoryList');
            historyContainer.innerHTML = `<div class="match-card skeleton" style="height: 60px;"></div><div class="match-card skeleton" style="height: 60px;"></div>`;
        
            try {
                // FETCH
                const response = await fetch(`/api?player=${username}`);
                const data = await response.json();
        
                if(data.error) { 
                    alert("Player not found!"); 
                    idsToLoad.forEach(id => {
                         const el = document.getElementById(id);
                         if(el) el.classList.remove('skeleton');
                    });
                    return; 
                }
        
                saveToHistory(username);
        
                // UPDATE TEXT
                document.getElementById('nameDisplay').innerText = data.stats.name || username;
                document.getElementById('kdrVal').innerText = parseFloat(data.stats.kdr).toFixed(2);
                document.getElementById('winsVal').innerText = data.stats.wins;
                document.getElementById('streakVal').innerText = data.stats.best_streak;
                document.getElementById('viewCount').innerText = data.stats.views || 0;
                document.getElementById('rankDisplay').innerText = `#${data.stats.rank}`;

                // Win Rate
                const totalGames = (data.stats.wins || 0) + (data.stats.losses || 0);
                let winPercent = totalGames > 0 ? Math.round((data.stats.wins / totalGames) * 100) : 50;
                document.getElementById('wr-percent').innerText = `${winPercent}%`;
                document.getElementById('bar-win').style.width = `${winPercent}%`;
                document.getElementById('bar-loss').style.width = `${100 - winPercent}%`;
        
                // CHARTS
                renderChart(data.matches, username);
                renderBiometrics(data.stats);
                findNemesis(data.matches, username);
                
                // HISTORY
                historyContainer.innerHTML = ''; 
                data.matches.forEach(match => {
                    const isWin = match.winner_name.toLowerCase() === username.toLowerCase();
                    const opponent = isWin ? match.loser_name : match.winner_name;
                    const cardClass = isWin ? 'win' : 'loss';
                    const outcomeText = isWin ? 'VICTORY' : 'DEFEAT';
                    historyContainer.innerHTML += `
                        <div class="match-card ${cardClass}">
                            <div class="match-outcome"><span>${outcomeText}</span></div>
                            <div class="match-vs">
                                <span style="color:#666; font-size:0.8rem;">VS</span>
                                <span class="opponent-name">${opponent}</span>
                            </div>
                        </div>`;
                });
        
                // IMAGES
                const skinContainer = document.getElementById('skinContainer');
                skinImg.onload = () => {
                    skinImg.classList.add('loaded');
                    skinContainer.classList.remove('skeleton');
                };
                skinImg.onerror = () => skinContainer.classList.remove('skeleton');
                skinImg.src = `https://visage.surgeplay.com/full/512/${username}`;

                // CLEANUP REMAINING SKELETONS
                idsToLoad.forEach(id => {
                    if(id !== 'skinContainer') { 
                        const el = document.getElementById(id);
                        if(el) el.classList.remove('skeleton');
                    }
                });
        
            } catch (error) { 
                console.error(error);
                idsToLoad.forEach(id => {
                    const el = document.getElementById(id);
                    if(el) el.classList.remove('skeleton');
                });
                alert("Error fetching data");
            }
        }

        // --- CHARTS ---
        function renderChart(matches, username) {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            const sortedMatches = [...matches].reverse(); 
            let currentScore = 0;
            const dataPoints = sortedMatches.map(m => {
                currentScore += (m.winner_name.toLowerCase() === username.toLowerCase()) ? 1 : -1;
                return currentScore;
            });
            const labels = sortedMatches.map((_, i) => `M${i + 1}`);
        
            if(myChart) myChart.destroy();
        
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Trend', data: dataPoints, borderColor: '#ff3e3e', backgroundColor: 'rgba(255, 62, 62, 0.1)',
                        borderWidth: 2, fill: true, tension: 0.4, pointRadius: 0
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { grid: { color: '#222' } } } }
            });
        }

        function renderBiometrics(stats) {
            const ctx = document.getElementById('radarChart').getContext('2d');
            
            const totalGames = (stats.wins + stats.losses) || 1;
            const survivability = Math.min(100, (stats.wins / totalGames) * 100 * 1.5);
            const lethality = Math.min(100, (parseFloat(stats.kdr) / 4) * 100);
            const consistency = Math.min(100, (stats.best_streak / 20) * 100);
            const experience = Math.min(100, (stats.wins / 100) * 100);
            const aggression = Math.min(100, (lethality * 1.2) - (survivability * 0.2));
            
            const dataValues = [survivability, lethality, consistency, experience, aggression];
            const maxIndex = dataValues.indexOf(Math.max(...dataValues));
            const classes = ["GUARDIAN", "ASSASSIN", "MACHINE", "VETERAN", "BERSERKER"];
            
            // Safe check for element existence
            const classEl = document.querySelector('#playerClass span');
            if(classEl) classEl.innerText = classes[maxIndex];
        
            if (myRadar) myRadar.destroy();
        
            myRadar = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['SURV', 'LETHAL', 'CONST', 'EXP', 'AGGRO'],
                    datasets: [{
                        data: dataValues, backgroundColor: 'rgba(255, 62, 62, 0.2)', borderColor: '#ff3e3e',
                        borderWidth: 2, pointRadius: 0
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: { r: { angleLines: { color: '#333' }, grid: { color: '#222' }, pointLabels: { color: '#888', font: { size: 10 } }, ticks: { display: false }, suggestedMin: 0, suggestedMax: 100 } },
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        function findNemesis(matches, username) {
            const killers = {};
            let maxKills = 0;
            let nemesis = "None";
            matches.forEach(m => {
                if (m.winner_name.toLowerCase() !== username.toLowerCase()) {
                    killers[m.winner_name] = (killers[m.winner_name] || 0) + 1;
                    if (killers[m.winner_name] > maxKills) { maxKills = killers[m.winner_name]; nemesis = m.winner_name; }
                }
            });
            document.getElementById('nemesisName').innerText = nemesis === "None" ? "UNDEFEATED" : nemesis;
            document.getElementById('nemesisKills').innerText = maxKills;
            const headUrl = nemesis === "None" ? "Steve" : nemesis;
            document.getElementById('nemesisHead').src = `https://visage.surgeplay.com/face/128/${headUrl}`;
        }

        // --- UTILS ---
        function setupAutocomplete() {
            const input = document.getElementById('playerInput');
            const box = document.getElementById('suggestions-box');
            let debounceTimer;

            input.addEventListener('input', function() {
                const val = this.value;
                clearTimeout(debounceTimer);
                if (val.length < 2) { box.style.display = 'none'; return; }

                debounceTimer = setTimeout(async () => {
                    try {
                        const res = await fetch(`/api/search?q=${val}`);
                        const names = await res.json();
                        box.innerHTML = '';
                        if (names.length > 0) {
                            box.style.display = 'block';
                            names.forEach(n => {
                                const div = document.createElement('div');
                                div.className = 'suggestion-item';
                                div.innerHTML = `<img src="https://visage.surgeplay.com/face/32/${n.name}" class="sug-head"><span>${n.name}</span>`;
                                div.onclick = () => { input.value = n.name; box.style.display = 'none'; fetchStats(); };
                                box.appendChild(div);
                            });
                        } else { box.style.display = 'none'; }
                    } catch (e) { console.error(e); }
                }, 300);
            });
            document.addEventListener('click', function(e) { if (e.target !== input && e.target !== box) box.style.display = 'none'; });
        }

        function updateRecent() {
            let history = JSON.parse(localStorage.getItem('searchHistory')) || [];
            const container = document.getElementById('recent-container');
            const list = document.getElementById('recent-list');
            if(history.length === 0) { container.style.display = 'none'; return; }
            container.style.display = 'block'; list.innerHTML = '';
            history.forEach(name => {
                const tag = document.createElement('div');
                tag.className = 'recent-tag';
                tag.innerHTML = `<img src="https://visage.surgeplay.com/face/32/${name}" class="recent-head">${name}`;
                tag.onclick = () => { document.getElementById('playerInput').value = name; fetchStats(); };
                list.appendChild(tag);
            });
        }
        function saveToHistory(name) {
            let history = JSON.parse(localStorage.getItem('searchHistory')) || [];
            history = history.filter(n => n.toLowerCase() !== name.toLowerCase());
            history.unshift(name);
            if(history.length > 3) history.pop();
            localStorage.setItem('searchHistory', JSON.stringify(history));
            updateRecent();
        }
        function copyIP() {
            navigator.clipboard.writeText("play.slashup.net");
            const toast = document.getElementById("toast-box");
            toast.classList.add("show");
            setTimeout(() => toast.classList.remove("show"), 3000);
        }

        // --- BACKGROUND ---
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        function resizeCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        class Particle {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * canvas.width; this.y = canvas.height + Math.random() * 100;
                this.size = Math.random() * 3 + 1; this.speedY = Math.random() * 1 + 0.5;
                this.opacity = Math.random() * 0.5 + 0.1;
            }
            update() { this.y -= this.speedY; this.opacity -= 0.002; if(this.opacity <= 0) this.reset(); }
            draw() { ctx.fillStyle = `rgba(255, 62, 62, ${this.opacity})`; ctx.fillRect(this.x, this.y, this.size, this.size); }
        }
        function initParticles() { for(let i=0; i<50; i++) particles.push(new Particle()); }
        function animateParticles() { ctx.clearRect(0,0,canvas.width,canvas.height); particles.forEach(p=>{p.update();p.draw();}); requestAnimationFrame(animateParticles); }
    </script>
</body>
</html>
